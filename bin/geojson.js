const axios = require('axios')
const fs = require('fs')
const api = 'https://www.mocaspike150.org/api'

const feature = (d) => ({
  "type": "Feature",
  "geometry": {
    "type": "Point",
    "coordinates": [
      d[0],
      d[1]
    ]
  }
})

console.log(`Files in this folder are generated by script. Please do not edit them.`)

const profile = 'club/profile.json'
const geo = 'map/club/geo.json'

const build = (profile, geo) => {
  axios.get(`${api}/${profile}`).
    then( (res) => {
      let profile_data = res.data
      axios.get(`${api}/${geo}`)
        .then( (res) => {
          let geo_data = res.data
          for( k in profile_data) {
            if( k in geo_data){
               let geojson = {
                 "type": "FeatureCollection",
                 "features": geo_data[k].map(feature)
               }
               let output = JSON.stringify(geojson)
               let fn = `map/club/${k}.geojson`
               console.log(` - ${profile_data[k].en} ${profile_data[k].cn} [${k}.geojson](${k}.geojson) `)
               fs.writeFile(`map/club/${k}.geojson`, output, () => {})
            }
            else {
               console.log(` - ${profile_data[k].en} ${profile_data[k].cn} (${k}.geojson) `)
            }
          }
    })
  .catch((error) => { console.log(error) });
    })

  .catch((error) => { console.log(error) });
/*
  axios.get(`${api}/${geo}`)
  .then( (res) => {
    let data = res.data
    for( k in data) {
      let geojson = {
        "type": "FeatureCollection",
        "features": data[k].map(feature) 
      }
      let output = JSON.stringify(geojson)
      let fn = `map/club/${k}.geojson`
      console.log(` - [${k}.geojson](${k}.geojson) `)
      fs.writeFile(`map/club/${k}.geojson`, output, () => {})
    }
  })
  .catch((error) => { console.log(error) });
*/
}

build(profile, geo)


